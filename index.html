<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Harry Potter DEBUG</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div style="position: fixed; top: 10px; width:100%; text-align: center; z-index: 1; color: red; font-weight: bold;">
        DEBUG MODE - NO AUDIO
    </div>

    <a-scene vr-mode-ui="enabled: false;"
             renderer="logarithmicDepthBuffer: true;"
             embedded
             arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">

        <script>
            let isUnlocked = false;

            AFRAME.registerComponent('magic-handler', {
                init: function () {
                    const markerKey = document.querySelector('#marker-key');
                    const markerBase = document.querySelector('#marker-base');
                    const debugBox = document.querySelector('#debug-box');
                    const statusText = document.querySelector('#status-text');

                    // 1. CHEIA (Stema)
                    markerKey.addEventListener('markerFound', () => {
                        isUnlocked = true;
                        console.log("Cheia gasita!");
                    });

                    // 2. BAZA (Posterul)
                    markerBase.addEventListener('markerFound', () => {
                        if (isUnlocked) {
                            // Daca e deblocat -> Apare o cutie VERDE
                            debugBox.setAttribute('material', 'color: green');
                            debugBox.setAttribute('visible', 'true');
                            statusText.setAttribute('value', 'UNLOCKED');
                            statusText.setAttribute('color', 'green');
                        } else {
                            // Daca e blocat -> Nu apare cutia (sau apare rosie daca vrei)
                            debugBox.setAttribute('visible', 'false');
                            statusText.setAttribute('value', 'LOCKED');
                            statusText.setAttribute('color', 'red');
                        }
                    });
                }
            });
        </script>

        <a-nft id="marker-key" magic-handler type="nft" url="./nft/alp"
               smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
            <a-text value="KEY FOUND" rotation="-90 0 0" scale="80 80 80" align="center" color="cyan"></a-text>
        </a-nft>

        <a-nft id="marker-base" magic-handler type="nft" url="./nft/ap"
               smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">

            <a-box id="debug-box"
                   position="0 0 0"
                   scale="150 150 150"
                   color="red"
                   visible="false">
            </a-box>

            <a-text id="status-text" value="LOCKED" rotation="-90 0 0" position="0 0 -100" scale="100 100 100" align="center" color="red"></a-text>
        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>